# CVE-2023-2800

# 一、漏洞解释

就是一个很水的漏洞，几乎没有危害，危害是有的就是很难被利用，是调用的Python里的一个类库有风险，后来修复的时候修改为了调用安全的函数。

影响范围：Affected versions < 4.30.0   Patched versions 4.30.0

这个漏洞就没啥好解释的，感觉就是一个水洞：

https://github.com/huggingface/transformers/pull/23372/files

就是修改了一个函数，之前是调用的template.mktemp()：

![QQ_1729519149657](./README.assets/QQ_1729519149657.png)



`tempfile.mktemp()` 和 `tempfile.mkstemp()` 是 Python 标准库 `tempfile` 模块中的两个函数，它们都用于创建临时文件，但它们之间有一些关键的区别：

1. **安全性**：
   - `tempfile.mktemp()`：这个函数生成一个唯一的文件名，但它不会创建一个实际的文件，也不会设置任何文件权限。这意味着在文件实际创建之前，如果另一个进程使用相同的模式生成了一个文件名，就可能发生文件名冲突。此外，因为没有设置文件权限，所以存在安全风险，即其他用户可能能够在文件被创建之前访问或修改这个文件。
   - `tempfile.mkstemp()`：这个函数不仅生成一个唯一的文件名，还会创建一个实际的文件，并设置文件权限，使得只有文件的所有者可以读写这个文件。这提供了更好的安全性，因为它减少了文件名冲突和安全漏洞的风险。

2. **返回值**：
   - `tempfile.mktemp()`：返回一个字符串，即生成的临时文件的路径名。
   - `tempfile.mkstemp()`：返回一个文件描述符和一个文件名。文件描述符可以直接用于读写文件，而不需要使用 `open()` 函数。

3. **使用方式**：
   - `tempfile.mktemp()` 通常需要与 `open()` 函数结合使用，以创建并打开文件。
   - `tempfile.mkstemp()` 可以直接用于创建并打开文件，因为它返回一个文件描述符。

下面是一个简单的示例，展示如何使用这两个函数：

```python
import tempfile
import os

# 使用 tempfile.mktemp()
temp_name = tempfile.mktemp()
with open(temp_name, 'w') as f:
    f.write("Hello, World!")
# 在这里，你需要手动删除文件
os.remove(temp_name)

# 使用 tempfile.mkstemp()
fd, temp_name = tempfile.mkstemp()
with open(temp_name, 'w') as f:
    f.write("Hello, World!")
# 文件会在关闭时自动删除，但你也可以手动删除
os.close(fd)
os.remove(temp_name)
```

在现代的 Python 编程实践中，推荐使用 `tempfile.mkstemp()` 或者 `tempfile` 模块中的其他更高级的函数（如 `NamedTemporaryFile`），因为它们提供了更好的安全性和更方便的文件处理方式。

看一下这两个函数创建的文件的区别：

```

```





























# 参考资料 
- https://github.com/advisories/GHSA-282v-666c-3fvg
- https://huntr.com/bounties/a3867b4e-6701-4418-8c20-3c6e7084a44a
- https://github.com/huggingface/transformers/pull/23372
- https://huntr.dev/bounties/a3867b4e-6701-4418-8c20-3c6e7084a44a
- https://github.com/huggingface/transformers/commit/80ca92470938bbcc348e2d9cf4734c7c25cb1c43
- https://nvd.nist.gov/vuln/detail/CVE-2023-2800
- https://www.ogma.in/understanding-cve-2023-2800-insecure-temporary-file-in-huggingface-transformers



